<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Web Page with Adjustable Bottom Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Add jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Add DataTables JS -->
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

  <style>
    /* Styles for the vertical panel */
    #sidebar {
      height: calc(100vh - 56px); /* Subtracting header height */
      width: 250px;
      position: fixed;
      top: 56px; /* Below the header */
      left: -250px;
      background-color: #343a40;
      transition: all 0.3s;
      padding-top: 20px;
    }

    #sidebar.show {
      left: 0;
    }

    #sidebar button {
      margin: 20px;
    }

    /* Styles for the modal panel */
    #modalPanel {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      background-color: white;
      border: 1px solid #ccc;
      padding: 20px;
      z-index: 1000;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    /* Overlay to close modal */
    #modalOverlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
    }

    /* Main section styles */
    main {
      margin-left: 0;
      transition: margin-left 0.3s;
      padding: 20px;
      height: calc(100vh - 56px);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #sidebar.show + main {
      margin-left: 250px;
    }

    /* Adjustable bottom panel */
    #adjustableContainer {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    #scrollablePanel {
      position: fixed;
      bottom: 0;
      height: 150px; /* Initial height */
      overflow-y: auto;
      background-color: #f1f1f1;
      padding: 10px;
      border-top: 5px solid #ccc; /* Thicker border for easier grabbing */
      cursor: ns-resize;
      left: 0;
      right: 0;
      transition: margin-left 0.3s; /* Smooth transition for margin change */
    }

    /* Header alignment */
    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    /* Center the title */
    .navbar-brand-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    /* Fix the width of logo on the right */
    .navbar-logo {
      display: flex;
      align-items: center;
    }

    /* Styles for the DataTable in sidebar */
    #sidebar .dataTables_wrapper {
      color: white;
    }
    #sidebar table.dataTable tbody tr {
      background-color: #343a40;
      color: white;
    }
    #sidebar table.dataTable tbody tr.selected {
      background-color: #007bff;
    }
    #addRowBtn {
      margin-top: 10px;
    }
    .deleteBtn {
      padding: 2px 5px;
      background-color: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="navbar navbar-dark bg-dark">
    <div class="container-fluid header-container">
      <!-- Left - Burger menu -->
      <button class="navbar-toggler" type="button" id="burgerButton">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Center - Title -->
      <a href="#" class="navbar-brand navbar-brand-center">My Website</a>

      <!-- Right - Logo -->
      <div class="navbar-logo">
        <img src="images/scope-logo.png" alt="Logo" height="40" class="d-inline-block align-top">
      </div>
    </div>
  </header>

  <!-- Left Sidebar -->
  <div id="sidebar" class="bg-dark">
    <button id="addRowBtn" class="btn btn-sm btn-primary mb-3">+</button>
    <table id="sidebarTable" class="display" style="width:100%">
      <thead>
        <tr>
          <th></th>
          <th>Text</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <!-- Main Section -->
  <main>
    <h1>Main Content</h1>
    <p>This is the main section. It will shift to the right when the sidebar is toggled open, and shift back when the sidebar is closed.</p>

    <!-- Adjustable Panel -->
    <div id="adjustableContainer">
      <div id="scrollablePanel">
        <p>Scrollable Content Panel</p>
        <p>Content inside the scrollable panel.<br> You can place any content here. Scroll if necessary, and drag the bar to adjust the height.</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi.</p>
        <p>Another content item...</p>
        <p>And more content here...</p>
      </div>
    </div>
  </main>

  <!-- Modal Panel -->
  <div id="modalOverlay"></div>
  <div id="modalPanel">
    <button class="close btn-close" id="closeModalButton"></button>
    <h4>This is the middle panel</h4>
    <p>Content goes here...</p>
  </div>

  <script>
    // Toggle sidebar
    document.getElementById('burgerButton').addEventListener('click', function () {
      const sidebar = document.getElementById('sidebar');
      const scrollablePanel = document.getElementById('scrollablePanel');

      sidebar.classList.toggle('show');

      // Adjust margin for the scrollable panel
      if (sidebar.classList.contains('show')) {
        scrollablePanel.style.marginLeft = '250px';
      } else {
        scrollablePanel.style.marginLeft = '0';
      }
    });

    // Remove or comment out the following block
    /*
    // Open modal panel
    document.getElementById('openModalButton').addEventListener('click', function () {
      document.getElementById('modalPanel').style.display = 'block';
      document.getElementById('modalOverlay').style.display = 'block';
    });
    */

    // Close modal panel with button
    document.getElementById('closeModalButton').addEventListener('click', function () {
      document.getElementById('modalPanel').style.display = 'none';
      document.getElementById('modalOverlay').style.display = 'none';
    });

    // Close modal panel by clicking outside
    document.getElementById('modalOverlay').addEventListener('click', function () {
      document.getElementById('modalPanel').style.display = 'none';
      document.getElementById('modalOverlay').style.display = 'none';
    });

    // Resizing logic for both desktop and mobile
    const scrollablePanel = document.getElementById('scrollablePanel');
    let isResizing = false;

    // Desktop: mouse events
    scrollablePanel.addEventListener('mousedown', function(e) {
      isResizing = true;
      document.body.style.userSelect = 'none'; // Disable text selection during resizing
      document.addEventListener('mousemove', resizePanel);
      document.addEventListener('mouseup', stopResizing);
    });

    // Mobile: touch events
    scrollablePanel.addEventListener('touchstart', function(e) {
      isResizing = true;
      document.body.style.userSelect = 'none'; // Disable text selection during resizing
      document.addEventListener('touchmove', resizePanelTouch);
      document.addEventListener('touchend', stopResizing);
    });

    function resizePanel(e) {
      if (!isResizing) return;

      // Calculate the new top position for the scrollable panel
      const newTop = e.clientY;

      // Make sure the new top doesn't go above the main content area
      if (newTop > 100 && newTop < (window.innerHeight - 50)) {
        const height = window.innerHeight - newTop;
        scrollablePanel.style.height = `${height}px`;
      }
    }

    function resizePanelTouch(e) {
      if (!isResizing) return;

      // Use touch event to get the Y coordinate
      const touch = e.touches[0];
      const newTop = touch.clientY;

      // Make sure the new top doesn't go above the main content area
      if (newTop > 100 && newTop < (window.innerHeight - 50)) {
        const height = window.innerHeight - newTop;
        scrollablePanel.style.height = `${height}px`;
      }
    }

    function stopResizing() {
      isResizing = false;
      document.body.style.userSelect = ''; // Re-enable text selection after resizing
      document.removeEventListener('mousemove', resizePanel);
      document.removeEventListener('mouseup', stopResizing);
      document.removeEventListener('touchmove', resizePanelTouch);
      document.removeEventListener('touchend', stopResizing);
    }

    // Move DataTable initialization outside of document.ready
    var table;

    // Initialize DataTable after the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOMContentLoaded");
      console.log("Add button exists:", $('#addRowBtn').length > 0);

      var rowCounter = 0;  // Counter to keep track of row creation order

      table = $('#sidebarTable').DataTable({
        paging: false,
        searching: false,
        info: false,
        columns: [
          {
            data: null,
            render: function(data, type, row) {
              return '<button class="deleteBtn">üóëÔ∏è</button>';
            },
            orderable: false
          },
          { data: 'text' },
          { data: 'order', visible: false }  // Hidden column for ordering
        ],
        select: {
          style: 'single'
        },
        order: [[2, 'desc']]  // Sort by the hidden 'order' column
      });
      console.log("DataTable initialized:", table);

      // Add new row at the top
      $('#addRowBtn').on('click', function() {
        console.log("Add button clicked");
        rowCounter++;
        table.row.add({text: '', order: rowCounter}).draw(false);

        // Scroll to the top of the table
        $('#sidebarTable').parent().scrollTop(0);
      });

      // Delete row
      $('#sidebarTable tbody').on('click', '.deleteBtn', function() {
        table.row($(this).parents('tr')).remove().draw();
      });

      // Make second column editable
      $('#sidebarTable tbody').on('dblclick', 'td:nth-child(2)', function() {
        var cell = table.cell(this);
        var data = cell.data();
        $(this).html('<input type="text" value="' + data + '">');
        $('input', this).focus();
      });

      $('#sidebarTable tbody').on('blur', 'input', function() {
        var cell = table.cell($(this).parent());
        cell.data($(this).val()).draw();
      });
    });

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
